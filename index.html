<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zen Breath Trainer (Cloud Sync)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="min-h-screen">
    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="mb-6 border-b border-indigo-900 pb-4">
            <h1 class="text-3xl font-extrabold text-indigo-400">Zen Breath Trainer ðŸ§˜</h1>
            <p id="user-id-display" class="text-xs text-gray-500 mt-2 break-all">Sync Status: Connecting to Cloud...</p>
        </header>

        <!-- Loading State -->
        <div id="loading-state" class="text-center p-8 bg-gray-800 rounded-xl shadow-md">
            <p class="text-indigo-400 font-semibold">Establishing secure cloud connection...</p>
        </div>

        <!-- App Content (Hidden until loaded) -->
        <div id="app-content" class="hidden">

            <!-- Tab Navigation -->
            <div id="tabs" class="flex border-b border-indigo-900 mb-6">
                <button id="routines-tab"
                    class="py-2 px-4 text-sm font-semibold text-gray-400 transition duration-150 hover:text-white tab-active">
                    Routines & Create
                </button>
                <button id="history-tab"
                    class="py-2 px-4 text-sm font-semibold text-gray-400 transition duration-150 hover:text-white">
                    Training History
                </button>
            </div>


            <!-- Main Routine Selection Screen -->
            <div id="main-screen" class="space-y-8">

                <!-- Notification Message -->
                <div id="notification-message" class="hidden"></div>

                <!-- Routine Selector (Includes Built-in and Saved) -->
                <div id="routine-selector" class="rounded-xl p-4 bg-gray-800 shadow-xl">
                    <!-- Routines injected here by JS -->
                </div>

                <!-- Create Custom Routine Form -->
                <div class="bg-gray-800 p-6 rounded-xl shadow-xl border border-indigo-900">
                    <h2 class="text-xl font-semibold text-indigo-400 mb-4">Create & Save Custom Routine</h2>
                    <form id="custom-routine-form" class="space-y-4">
                        <input type="text" id="input-name" placeholder="Routine Name (e.g., Deep Focus)" required
                            class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">

                        <div class="grid grid-cols-2 gap-4">
                            <!-- Phase Inputs -->
                            <div class="col-span-1">
                                <label for="input-in" class="block text-sm font-medium text-gray-400">Inhale
                                    (seconds)</label>
                                <input type="number" id="input-in" value="4" min="0" required
                                    class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">
                            </div>
                            <div class="col-span-1">
                                <label for="input-hold-in" class="block text-sm font-medium text-gray-400">Hold In
                                    (seconds)</label>
                                <input type="number" id="input-hold-in" value="0" min="0" required
                                    class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">
                            </div>
                            <div class="col-span-1">
                                <label for="input-out" class="block text-sm font-medium text-gray-400">Exhale
                                    (seconds)</label>
                                <input type="number" id="input-out" value="6" min="0" required
                                    class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">
                            </div>
                            <div class="col-span-1">
                                <label for="input-hold-out" class="block text-sm font-medium text-gray-400">Hold Out
                                    (seconds)</label>
                                <input type="number" id="input-hold-out" value="0" min="0" required
                                    class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">
                            </div>
                        </div>

                        <!-- Duration Input -->
                        <div>
                            <label for="input-minutes" class="block text-sm font-medium text-gray-400">Total Duration
                                (minutes)</label>
                            <input type="number" id="input-minutes" value="5" min="1" required
                                class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 text-white">
                        </div>

                        <button type="submit"
                            class="w-full bg-green-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-green-700 transition duration-300 shadow-lg hover:shadow-xl transform hover:scale-[1.01]">
                            Save Routine to Cloud (Sync)
                        </button>
                    </form>
                </div>
            </div>

            <!-- History Screen -->
            <div id="history-screen" class="hidden">
                <h2 class="text-2xl font-semibold text-indigo-400 mb-4">Training History</h2>
                <div id="history-list" class="space-y-4 max-h-[60vh] overflow-y-auto p-2">
                    <!-- History items injected here by JS -->
                </div>
            </div>

            <!-- Training Screen -->
            <div id="training-screen" class="hidden text-center flex flex-col items-center justify-center min-h-[60vh]">
                <div id="breathing-circle-container" class="mb-12">
                    <!-- Guide Ring for Max Size -->
                    <div id="max-size-ring"></div>
                    <div id="breathing-circle"></div>
                </div>

                <p id="instruction-text"
                    class="text-4xl font-extrabold text-indigo-300 mb-8 transition-colors duration-500">Get Ready</p>

                <!-- Progress Bar -->
                <div class="w-full max-w-xs bg-gray-700 rounded-full h-2.5 mb-8">
                    <div id="progress-bar"
                        class="bg-indigo-500 h-2.5 rounded-full transition-all duration-100 ease-linear"
                        style="width: 0%"></div>
                </div>

                <div class="flex space-x-4">
                    <button id="stop-btn"
                        class="px-6 py-3 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 transition duration-300 shadow-md transform active:scale-95">
                        Stop Training
                    </button>
                    <button id="back-btn"
                        class="px-6 py-3 bg-gray-600 text-white font-bold rounded-lg hover:bg-gray-700 transition duration-300 shadow-md transform active:scale-95 hidden">
                        Back to Routines
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- Confirmation Modal for Deletion -->
    <div id="delete-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 z-50 hidden transition-opacity duration-300">
        <div
            class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-sm p-6 bg-gray-800 rounded-xl shadow-2xl">
            <h3 class="text-xl font-bold text-red-400 mb-4">Confirm Deletion</h3>
            <p class="text-gray-300 mb-6">Are you sure you want to delete the custom routine: <span
                    id="delete-routine-name" class="font-semibold text-white"></span>?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-delete-btn"
                    class="px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-150">
                    Cancel
                </button>
                <button id="confirm-delete-btn"
                    class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-150 shadow-md">
                    Yes, Delete
                </button>
            </div>
        </div>
    </div>

    <!-- Load application modules -->
    <script type="module" src="app.js"></script>

</body>

</html>
